/*!@preserve  
 * main
 * Third-parties included:
 * - vanilla-lazyload
 * - lity lightbox
 */
///////////////////////////
//    Libraries          //
///////////////////////////

/** jQuery throttle / debounce v1.1 
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
//_include ./libs/ofi.min.js            // Remove for HorusecEngine scan report risk @20230414		
//_include ./libs/picturefill.min.js    // Remove for HorusecEngine scan report risk @20230414
// $(function(){                           // Remove for HorusecEngine scan report risk @20230414
// 	objectFitImages(null,{ watchMQ: true, skipTest: false});  
// });  
//__include ./libs/stickyfill.min.js
/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/intersection-observer@0.12.0/intersection-observer.js
 */
!function(){"use strict";if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var t=function(t){for(var e=window.document,o=i(e);o;)o=i(e=o.ownerDocument);return e}(),e=[],o=null,n=null;s.prototype.THROTTLE_TIMEOUT=100,s.prototype.POLL_INTERVAL=null,s.prototype.USE_MUTATION_OBSERVER=!0,s._setupCrossOriginUpdater=function(){return o||(o=function(t,o){n=t&&o?l(t,o):{top:0,bottom:0,left:0,right:0,width:0,height:0},e.forEach((function(t){t._checkForIntersections()}))}),o},s._resetCrossOriginUpdater=function(){o=null,n=null},s.prototype.observe=function(t){if(!this._observationTargets.some((function(e){return e.element==t}))){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(t.ownerDocument),this._checkForIntersections()}},s.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter((function(e){return e.element!=t})),this._unmonitorIntersections(t.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},s.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},s.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},s.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter((function(t,e,o){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==o[e-1]}))},s.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map((function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}}));return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},s.prototype._monitorIntersections=function(e){var o=e.defaultView;if(o&&-1==this._monitoringDocuments.indexOf(e)){var n=this._checkForIntersections,r=null,s=null;this.POLL_INTERVAL?r=o.setInterval(n,this.POLL_INTERVAL):(h(o,"resize",n,!0),h(e,"scroll",n,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in o&&(s=new o.MutationObserver(n)).observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(e),this._monitoringUnsubscribes.push((function(){var t=e.defaultView;t&&(r&&t.clearInterval(r),c(t,"resize",n,!0)),c(e,"scroll",n,!0),s&&s.disconnect()}));var u=this.root&&(this.root.ownerDocument||this.root)||t;if(e!=u){var a=i(e);a&&this._monitorIntersections(a.ownerDocument)}}},s.prototype._unmonitorIntersections=function(e){var o=this._monitoringDocuments.indexOf(e);if(-1!=o){var n=this.root&&(this.root.ownerDocument||this.root)||t;if(!this._observationTargets.some((function(t){var o=t.element.ownerDocument;if(o==e)return!0;for(;o&&o!=n;){var r=i(o);if((o=r&&r.ownerDocument)==e)return!0}return!1}))){var r=this._monitoringUnsubscribes[o];if(this._monitoringDocuments.splice(o,1),this._monitoringUnsubscribes.splice(o,1),r(),e!=n){var s=i(e);s&&this._unmonitorIntersections(s.ownerDocument)}}}},s.prototype._unmonitorAllIntersections=function(){var t=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var e=0;e<t.length;e++)t[e]()},s.prototype._checkForIntersections=function(){if(this.root||!o||n){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach((function(n){var i=n.element,s=u(i),h=this._rootContainsTarget(i),c=n.entry,a=t&&h&&this._computeTargetAndRootIntersection(i,s,e),l=null;this._rootContainsTarget(i)?o&&!this.root||(l=e):l={top:0,bottom:0,left:0,right:0,width:0,height:0};var f=n.entry=new r({time:window.performance&&performance.now&&performance.now(),target:i,boundingClientRect:s,rootBounds:l,intersectionRect:a});c?t&&h?this._hasCrossedThreshold(c,f)&&this._queuedEntries.push(f):c&&c.isIntersecting&&this._queuedEntries.push(f):this._queuedEntries.push(f)}),this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},s.prototype._computeTargetAndRootIntersection=function(e,i,r){if("none"!=window.getComputedStyle(e).display){for(var s,h,c,a,f,d,g,m,v=i,_=p(e),b=!1;!b&&_;){var w=null,y=1==_.nodeType?window.getComputedStyle(_):{};if("none"==y.display)return null;if(_==this.root||9==_.nodeType)if(b=!0,_==this.root||_==t)o&&!this.root?!n||0==n.width&&0==n.height?(_=null,w=null,v=null):w=n:w=r;else{var I=p(_),E=I&&u(I),T=I&&this._computeTargetAndRootIntersection(I,E,r);E&&T?(_=I,w=l(E,T)):(_=null,v=null)}else{var R=_.ownerDocument;_!=R.body&&_!=R.documentElement&&"visible"!=y.overflow&&(w=u(_))}if(w&&(s=w,h=v,c=void 0,a=void 0,f=void 0,d=void 0,g=void 0,m=void 0,c=Math.max(s.top,h.top),a=Math.min(s.bottom,h.bottom),f=Math.max(s.left,h.left),d=Math.min(s.right,h.right),m=a-c,v=(g=d-f)>=0&&m>=0&&{top:c,bottom:a,left:f,right:d,width:g,height:m}||null),!v)break;_=_&&p(_)}return v}},s.prototype._getRootRect=function(){var e;if(this.root&&!d(this.root))e=u(this.root);else{var o=d(this.root)?this.root:t,n=o.documentElement,i=o.body;e={top:0,left:0,right:n.clientWidth||i.clientWidth,width:n.clientWidth||i.clientWidth,bottom:n.clientHeight||i.clientHeight,height:n.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(e)},s.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map((function(e,o){return"px"==e.unit?e.value:e.value*(o%2?t.width:t.height)/100})),o={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return o.width=o.right-o.left,o.height=o.bottom-o.top,o},s.prototype._hasCrossedThreshold=function(t,e){var o=t&&t.isIntersecting?t.intersectionRatio||0:-1,n=e.isIntersecting?e.intersectionRatio||0:-1;if(o!==n)for(var i=0;i<this.thresholds.length;i++){var r=this.thresholds[i];if(r==o||r==n||r<o!=r<n)return!0}},s.prototype._rootIsInDom=function(){return!this.root||f(t,this.root)},s.prototype._rootContainsTarget=function(e){var o=this.root&&(this.root.ownerDocument||this.root)||t;return f(o,e)&&(!this.root||o==e.ownerDocument)},s.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this)},s.prototype._unregisterInstance=function(){var t=e.indexOf(this);-1!=t&&e.splice(t,1)},window.IntersectionObserver=s,window.IntersectionObserverEntry=r}function i(t){try{return t.defaultView&&t.defaultView.frameElement||null}catch(t){return null}}function r(t){this.time=t.time,this.target=t.target,this.rootBounds=a(t.rootBounds),this.boundingClientRect=a(t.boundingClientRect),this.intersectionRect=a(t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,o=e.width*e.height,n=this.intersectionRect,i=n.width*n.height;this.intersectionRatio=o?Number((i/o).toFixed(4)):this.isIntersecting?1:0}function s(t,e){var o,n,i,r=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(r.root&&1!=r.root.nodeType&&9!=r.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(o=this._checkForIntersections.bind(this),n=this.THROTTLE_TIMEOUT,i=null,function(){i||(i=setTimeout((function(){o(),i=null}),n))}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(r.rootMargin),this.thresholds=this._initThresholds(r.threshold),this.root=r.root||null,this.rootMargin=this._rootMarginValues.map((function(t){return t.value+t.unit})).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function h(t,e,o,n){"function"==typeof t.addEventListener?t.addEventListener(e,o,n||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,o)}function c(t,e,o,n){"function"==typeof t.removeEventListener?t.removeEventListener(e,o,n||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,o)}function u(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function a(t){return!t||"x"in t?t:{top:t.top,y:t.top,bottom:t.bottom,left:t.left,x:t.left,right:t.right,width:t.width,height:t.height}}function l(t,e){var o=e.top-t.top,n=e.left-t.left;return{top:o,left:n,height:e.height,width:e.width,bottom:o+e.height,right:n+e.width}}function f(t,e){for(var o=e;o;){if(o==t)return!0;o=p(o)}return!1}function p(e){var o=e.parentNode;return 9==e.nodeType&&e!=t?i(e):(o&&o.assignedSlot&&(o=o.assignedSlot.parentNode),o&&11==o.nodeType&&o.host?o.host:o)}function d(t){return t&&9===t.nodeType}}();
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).LazyLoad=t()}(this,(function(){"use strict";function n(){return n=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},n.apply(this,arguments)}var t="undefined"!=typeof window,e=t&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),i=t&&"IntersectionObserver"in window,o=t&&"classList"in document.createElement("p"),a=t&&window.devicePixelRatio>1,r={elements_selector:".lazy",container:e||t?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1},c=function(t){return n({},r,t)},u=function(n,t){var e,i="LazyLoad::Initialized",o=new n(t);try{e=new CustomEvent(i,{detail:{instance:o}})}catch(n){(e=document.createEvent("CustomEvent")).initCustomEvent(i,!1,!1,{instance:o})}window.dispatchEvent(e)},l="src",s="srcset",f="sizes",d="poster",_="llOriginalAttrs",g="loading",v="loaded",b="applied",p="error",h="native",m="data-",E="ll-status",I=function(n,t){return n.getAttribute(m+t)},y=function(n){return I(n,E)},A=function(n,t){return function(n,t,e){var i="data-ll-status";null!==e?n.setAttribute(i,e):n.removeAttribute(i)}(n,0,t)},k=function(n){return A(n,null)},L=function(n){return null===y(n)},w=function(n){return y(n)===h},x=[g,v,b,p],O=function(n,t,e,i){n&&(void 0===i?void 0===e?n(t):n(t,e):n(t,e,i))},N=function(n,t){o?n.classList.add(t):n.className+=(n.className?" ":"")+t},C=function(n,t){o?n.classList.remove(t):n.className=n.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},M=function(n){return n.llTempImage},z=function(n,t){if(t){var e=t._observer;e&&e.unobserve(n)}},R=function(n,t){n&&(n.loadingCount+=t)},T=function(n,t){n&&(n.toLoadCount=t)},G=function(n){for(var t,e=[],i=0;t=n.children[i];i+=1)"SOURCE"===t.tagName&&e.push(t);return e},D=function(n,t){var e=n.parentNode;e&&"PICTURE"===e.tagName&&G(e).forEach(t)},V=function(n,t){G(n).forEach(t)},F=[l],j=[l,d],P=[l,s,f],S=function(n){return!!n[_]},U=function(n){return n[_]},$=function(n){return delete n[_]},q=function(n,t){if(!S(n)){var e={};t.forEach((function(t){e[t]=n.getAttribute(t)})),n[_]=e}},H=function(n,t){if(S(n)){var e=U(n);t.forEach((function(t){!function(n,t,e){e?n.setAttribute(t,e):n.removeAttribute(t)}(n,t,e[t])}))}},B=function(n,t,e){N(n,t.class_loading),A(n,g),e&&(R(e,1),O(t.callback_loading,n,e))},J=function(n,t,e){e&&n.setAttribute(t,e)},K=function(n,t){J(n,f,I(n,t.data_sizes)),J(n,s,I(n,t.data_srcset)),J(n,l,I(n,t.data_src))},Q={IMG:function(n,t){D(n,(function(n){q(n,P),K(n,t)})),q(n,P),K(n,t)},IFRAME:function(n,t){q(n,F),J(n,l,I(n,t.data_src))},VIDEO:function(n,t){V(n,(function(n){q(n,F),J(n,l,I(n,t.data_src))})),q(n,j),J(n,d,I(n,t.data_poster)),J(n,l,I(n,t.data_src)),n.load()}},W=["IMG","IFRAME","VIDEO"],X=function(n,t){!t||function(n){return n.loadingCount>0}(t)||function(n){return n.toLoadCount>0}(t)||O(n.callback_finish,t)},Y=function(n,t,e){n.addEventListener(t,e),n.llEvLisnrs[t]=e},Z=function(n,t,e){n.removeEventListener(t,e)},nn=function(n){return!!n.llEvLisnrs},tn=function(n){if(nn(n)){var t=n.llEvLisnrs;for(var e in t){var i=t[e];Z(n,e,i)}delete n.llEvLisnrs}},en=function(n,t,e){!function(n){delete n.llTempImage}(n),R(e,-1),function(n){n&&(n.toLoadCount-=1)}(e),C(n,t.class_loading),t.unobserve_completed&&z(n,e)},on=function(n,t,e){var i=M(n)||n;nn(i)||function(n,t,e){nn(n)||(n.llEvLisnrs={});var i="VIDEO"===n.tagName?"loadeddata":"load";Y(n,i,t),Y(n,"error",e)}(i,(function(o){!function(n,t,e,i){var o=w(t);en(t,e,i),N(t,e.class_loaded),A(t,v),O(e.callback_loaded,t,i),o||X(e,i)}(0,n,t,e),tn(i)}),(function(o){!function(n,t,e,i){var o=w(t);en(t,e,i),N(t,e.class_error),A(t,p),O(e.callback_error,t,i),o||X(e,i)}(0,n,t,e),tn(i)}))},an=function(n,t,e){!function(n){n.llTempImage=document.createElement("IMG")}(n),on(n,t,e),function(n){S(n)||(n[_]={backgroundImage:n.style.backgroundImage})}(n),function(n,t,e){var i=I(n,t.data_bg),o=I(n,t.data_bg_hidpi),r=a&&o?o:i;r&&(n.style.backgroundImage='url("'.concat(r,'")'),M(n).setAttribute(l,r),B(n,t,e))}(n,t,e),function(n,t,e){var i=I(n,t.data_bg_multi),o=I(n,t.data_bg_multi_hidpi),r=a&&o?o:i;r&&(n.style.backgroundImage=r,function(n,t,e){N(n,t.class_applied),A(n,b),e&&(t.unobserve_completed&&z(n,t),O(t.callback_applied,n,e))}(n,t,e))}(n,t,e)},rn=function(n,t,e){!function(n){return W.indexOf(n.tagName)>-1}(n)?an(n,t,e):function(n,t,e){on(n,t,e),function(n,t,e){var i=Q[n.tagName];i&&(i(n,t),B(n,t,e))}(n,t,e)}(n,t,e)},cn=function(n){n.removeAttribute(l),n.removeAttribute(s),n.removeAttribute(f)},un=function(n){D(n,(function(n){H(n,P)})),H(n,P)},ln={IMG:un,IFRAME:function(n){H(n,F)},VIDEO:function(n){V(n,(function(n){H(n,F)})),H(n,j),n.load()}},sn=function(n,t){(function(n){var t=ln[n.tagName];t?t(n):function(n){if(S(n)){var t=U(n);n.style.backgroundImage=t.backgroundImage}}(n)})(n),function(n,t){L(n)||w(n)||(C(n,t.class_entered),C(n,t.class_exited),C(n,t.class_applied),C(n,t.class_loading),C(n,t.class_loaded),C(n,t.class_error))}(n,t),k(n),$(n)},fn=["IMG","IFRAME","VIDEO"],dn=function(n){return n.use_native&&"loading"in HTMLImageElement.prototype},_n=function(n,t,e){n.forEach((function(n){return function(n){return n.isIntersecting||n.intersectionRatio>0}(n)?function(n,t,e,i){var o=function(n){return x.indexOf(y(n))>=0}(n);A(n,"entered"),N(n,e.class_entered),C(n,e.class_exited),function(n,t,e){t.unobserve_entered&&z(n,e)}(n,e,i),O(e.callback_enter,n,t,i),o||rn(n,e,i)}(n.target,n,t,e):function(n,t,e,i){L(n)||(N(n,e.class_exited),function(n,t,e,i){e.cancel_on_exit&&function(n){return y(n)===g}(n)&&"IMG"===n.tagName&&(tn(n),function(n){D(n,(function(n){cn(n)})),cn(n)}(n),un(n),C(n,e.class_loading),R(i,-1),k(n),O(e.callback_cancel,n,t,i))}(n,t,e,i),O(e.callback_exit,n,t,i))}(n.target,n,t,e)}))},gn=function(n){return Array.prototype.slice.call(n)},vn=function(n){return n.container.querySelectorAll(n.elements_selector)},bn=function(n){return function(n){return y(n)===p}(n)},pn=function(n,t){return function(n){return gn(n).filter(L)}(n||vn(t))},hn=function(n,e){var o=c(n);this._settings=o,this.loadingCount=0,function(n,t){i&&!dn(n)&&(t._observer=new IntersectionObserver((function(e){_n(e,n,t)}),function(n){return{root:n.container===document?null:n.container,rootMargin:n.thresholds||n.threshold+"px"}}(n)))}(o,this),function(n,e){t&&window.addEventListener("online",(function(){!function(n,t){var e;(e=vn(n),gn(e).filter(bn)).forEach((function(t){C(t,n.class_error),k(t)})),t.update()}(n,e)}))}(o,this),this.update(e)};return hn.prototype={update:function(n){var t,o,a=this._settings,r=pn(n,a);T(this,r.length),!e&&i?dn(a)?function(n,t,e){n.forEach((function(n){-1!==fn.indexOf(n.tagName)&&function(n,t,e){n.setAttribute("loading","lazy"),on(n,t,e),function(n,t){var e=Q[n.tagName];e&&e(n,t)}(n,t),A(n,h)}(n,t,e)})),T(e,0)}(r,a,this):(o=r,function(n){n.disconnect()}(t=this._observer),function(n,t){t.forEach((function(t){n.observe(t)}))}(t,o)):this.loadAll(r)},destroy:function(){this._observer&&this._observer.disconnect(),vn(this._settings).forEach((function(n){$(n)})),delete this._observer,delete this._settings,delete this.loadingCount,delete this.toLoadCount},loadAll:function(n){var t=this,e=this._settings;pn(n,e).forEach((function(n){z(n,t),rn(n,e,t)}))},restoreAll:function(){var n=this._settings;vn(n).forEach((function(t){sn(t,n)}))}},hn.load=function(n,t){var e=c(t);rn(n,e)},hn.resetStatus=function(n){k(n)},t&&function(n,t){if(t)if(t.length)for(var e,i=0;e=t[i];i+=1)u(n,e);else u(n,t)}(hn,window.lazyLoadOptions),hn}));

/*! Lity - v3.0.0-dev - 2020-04-26
* http://sorgalla.com/lity/
* Copyright (c) 2015-2020 Jan Sorgalla; Licensed MIT */

!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(c){return b(a,c)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,require("jquery")):a.lity=b(a,a.jQuery||a.Zepto)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function c(a){var b=y();return G&&a.length?(a.one(G,b.resolve),setTimeout(b.resolve,500)):b.resolve(),b.promise()}function d(a,c,d){if(1===arguments.length)return b.extend({},a);if("string"==typeof c){if(void 0===d)return void 0===a[c]?null:a[c];a[c]=d}else b.extend(a,c);return this}function e(a){var b=a.indexOf("?");b>-1&&(a=a.substr(b+1));for(var c,d=decodeURI(a.split("#")[0]).split("&"),e={},f=0,g=d.length;f<g;f++)d[f]&&(c=d[f].split("="),e[c[0]]=c[1]);return e}function f(a,c){if(!c)return a;if("string"===b.type(c)&&(c=e(c)),a.indexOf("?")>-1){var d=a.split("?");a=d.shift(),c=b.extend({},e(d[0]),c)}return a+"?"+b.param(c)}function g(a,b){var c=a.indexOf("#");return-1===c?b:(c>0&&(a=a.substr(c)),b+a)}function h(a,b,c,d){return b&&b.element().addClass("lity-iframe"),c&&(a=f(a,c)),d&&(a=g(d,a)),'<div class="lity-iframe-container"><iframe frameborder="0" allowfullscreen allow="autoplay; fullscreen" src="'+a+'"/></div>'}function i(a){return b('<span class="lity-error"></span>').append(a)}function j(a,c){var d=c.opener()&&c.opener().data("lity-desc")||"Image with no description",e=b('<img src="'+a+'" alt="'+d+'"/>'),f=y(),g=function(){f.reject(i("Failed loading image"))};return e.on("load",function(){if(0===this.naturalWidth)return g();f.resolve(e)}).on("error",g),f.promise()}function k(a,c){var d,e,f;try{d=b(a)}catch(a){return!1}return!!d.length&&(e=b('<i style="display:none !important"></i>'),f=d.hasClass("lity-hide"),c.element().one("lity:remove",function(){e.before(d).remove(),f&&!d.closest(".lity-content").length&&d.addClass("lity-hide")}),d.removeClass("lity-hide").after(e))}function l(a,b){return h(a,b)}function m(){return w.documentElement.clientHeight?w.documentElement.clientHeight:Math.round(x.height())}function n(a){var b=s();b&&(27===a.keyCode&&b.options("esc")&&b.close(),9===a.keyCode&&o(a,b))}function o(a,b){var c=b.element().find(D),d=c.index(w.activeElement);a.shiftKey&&d<=0?(c.get(c.length-1).focus(),a.preventDefault()):a.shiftKey||d!==c.length-1||(c.get(0).focus(),a.preventDefault())}function p(){b.each(A,function(a,b){b.resize()})}function q(a){1===A.unshift(a)&&(z.addClass("lity-active"),x.on({resize:p,keydown:n})),b("body > *").not(a.element()).addClass("lity-hidden").each(function(){var a=b(this);void 0===a.data(C)&&a.data(C,a.attr(B)||null)}).attr(B,"true")}function r(a){var c;a.element().attr(B,"true"),1===A.length&&(z.removeClass("lity-active"),x.off({resize:p,keydown:n})),A=b.grep(A,function(b){return a!==b}),c=A.length?A[0].element():b(".lity-hidden"),c.removeClass("lity-hidden").each(function(){var a=b(this),c=a.data(C);c?a.attr(B,c):a.removeAttr(B),a.removeData(C)})}function s(){return 0===A.length?null:A[0]}function t(a,c,d,e){var f,g="inline",h=b.extend({},d);return e&&h[e]?(f=h[e](a,c),g=e):(b.each(["inline","iframe"],function(a,b){delete h[b],h[b]=d[b]}),b.each(h,function(b,d){return!d||(!(!d.test||d.test(a,c))||(f=d(a,c),!1!==f?(g=b,!1):void 0))})),{handler:g,content:f||""}}function u(a,e,f,g){function h(a){k=b(a).css("max-height",m()+"px"),j.find(".lity-loader").each(function(){var a=b(this);c(a).always(function(){a.remove()})}),j.removeClass("lity-loading").find(".lity-content").empty().append(k),n=!0,k.trigger("lity:ready",[l])}var i,j,k,l=this,n=!1,o=!1;e=b.extend({},E,e),j=b(e.template),l.element=function(){return j},l.opener=function(){return f},l.content=function(){return k},l.options=b.proxy(d,l,e),l.handlers=b.proxy(d,l,e.handlers),l.resize=function(){n&&!o&&k.css("max-height",m()+"px").trigger("lity:resize",[l])},l.close=function(){if(n&&!o){o=!0,r(l);var a=y();if(g&&(w.activeElement===j[0]||b.contains(j[0],w.activeElement)))try{g.focus()}catch(a){}return k.trigger("lity:close",[l]),j.removeClass("lity-opened").addClass("lity-closed"),c(k.add(j)).always(function(){k.trigger("lity:remove",[l]),j.remove(),j=void 0,a.resolve()}),a.promise()}},i=t(a,l,e.handlers,e.handler),j.attr(B,"false").addClass("lity-loading lity-opened lity-"+i.handler).appendTo("body").focus().on("click","[data-lity-close]",function(a){b(a.target).is("[data-lity-close]")&&l.close()}).trigger("lity:open",[l]),q(l),b.when(i.content).always(h)}function v(a,c,d){a.preventDefault?(a.preventDefault(),d=b(this),a=d.data("lity-target")||d.attr("href")||d.attr("src")):d=b(d);var e=new u(a,b.extend({},d.data("lity-options")||d.data("lity"),c),d,w.activeElement);if(!a.preventDefault)return e}var w=a.document,x=b(a),y=b.Deferred,z=b("html"),A=[],B="aria-hidden",C="lity-"+B,D='a[href],area[href],input:not([disabled]),select:not([disabled]),textarea:not([disabled]),button:not([disabled]),iframe,object,embed,[contenteditable],[tabindex]:not([tabindex^="-"])',E={esc:!0,handler:null,handlers:{image:j,inline:k,iframe:l},template:'<div class="lity" role="dialog" aria-label="Dialog Window (Press escape to close)" tabindex="-1"><div class="lity-wrap" data-lity-close role="document"><div class="lity-loader" aria-hidden="true">Loading...</div><div class="lity-container"><div class="lity-content"></div><button class="lity-close" type="button" aria-label="Close (Press escape to close)" data-lity-close>&times;</button></div></div></div>'},F=/(^data:image\/)|(\.(png|jpe?g|gif|svg|webp|bmp|ico|tiff?)(\?\S*)?$)/i,G=function(){var a=w.createElement("div"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return b[c];return!1}();return j.test=function(a){return F.test(a)},v.version="3.0.0-dev",v.options=b.proxy(d,v,E),v.handlers=b.proxy(d,v,E.handlers),v.current=s,v.iframe=h,b(w).on("click.lity","[data-lity]",v),v});
/*! Lity - v3.0.0-dev - 2020-04-26
* http://sorgalla.com/lity/
* Copyright (c) 2015-2020 Jan Sorgalla; Licensed MIT */

!function(a,b){"function"==typeof define&&define.amd?define(["lity"],function(a){b(a)}):b("object"==typeof module&&"object"==typeof module.exports?require("lity"):a.lity)}("undefined"!=typeof window?window:this,function(a){"use strict";var b=/(youtube(-nocookie)?\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?([\w-]{11})(.*)?/i;a.handlers("youtube",function(c,d){var e=b.exec(c);return!!e&&a.iframe("https://www.youtube"+(e[2]||"")+".com/embed/"+e[4]+"?autoplay=1",d,e[5],c)})});
!function(c,T,S){"use strict";function k(e,t){return t.toUpperCase()}var p,n,x={get:function(){return K},init:function(e){return K||new B(e)},VERSION:"0.6.30"},w=Object.prototype.hasOwnProperty,g=c.Math,o=c.getComputedStyle,E="skrollable",A=E+"-before",F=E+"-between",H=E+"-after",a="skrollr",i="no-"+a,l=a+"-desktop",s=a+"-mobile",e=.004,f="skrollr-body",u=200,m="center",d="bottom",C="___skrollable_id",t=/^\s+|\s+$/g,P=/^data(?:-(_\w+))?(?:-?(-?\d*\.?\d+p?))?(?:-?(start|end|top|center|bottom))?(?:-?(top|center|bottom))?$/,v=/\s*(@?[\w\-\[\]]+)\s*:\s*(.+?)\s*(?:;|$)/gi,h=/^(@?[a-z\-]+)\[(\w+)\]$/,I=/-([a-z0-9_])/g,r=/[\-+]?[\d]*\.?[\d]+/g,y=/\{\?\}/g,b=/rgba?\(\s*-?\d+\s*,\s*-?\d+\s*,\s*-?\d+/g,O=/[a-z\-]+-gradient/g,V="",z="",D=function(){var e=/^(?:O|Moz|webkit|ms)|(?:-(?:o|moz|webkit|ms)-)/;if(o){var t,r=o(n,null);for(t in r)if(V=t.match(e)||+t==t&&r[t].match(e))break;V?"-"===(V=V[0]).slice(0,1)?V={"-webkit-":"webkit","-moz-":"Moz","-ms-":"ms","-o-":"O"}[z=V]:z="-"+V.toLowerCase()+"-":V=z=""}},L=function(){var e=c.requestAnimationFrame||c[V.toLowerCase()+"RequestAnimationFrame"],r=Se();return e=Oe||!e?function(e){var t=Se()-r,t=g.max(0,1e3/60-t);return c.setTimeout(function(){r=Se(),e()},t)}:e},q={begin:function(){return 0},end:function(){return 1},linear:function(e){return e},quadratic:function(e){return e*e},cubic:function(e){return e*e*e},swing:function(e){return-g.cos(e*g.PI)/2+.5},sqrt:function(e){return g.sqrt(e)},outCubic:function(e){return g.pow(e-1,3)+1},bounce:function(e){var t;if(e<=.5083)t=3;else if(e<=.8489)t=9;else if(e<=.96208)t=27;else{if(!(e<=.99981))return 1;t=91}return 1-g.abs(3*g.cos(e*t*1.028)/t)}};function B(e){if(p=T.documentElement,n=T.body,D(),K=this,re=(e=e||{}).constants||{},e.easing)for(var t in e.easing)q[t]=e.easing[t];le=e.edgeStrategy||"set",ee={beforerender:e.beforerender,render:e.render,keyframe:e.keyframe},(te=!1!==e.forceHeight)&&(we=e.scale||1),e.mobileDeceleration,ne=!1!==e.smoothScrolling,oe=e.smoothScrollingDuration||u,ae={targetTop:K.getScrollTop()},(Oe=(e.mobileCheck||function(){return/Android|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||c.opera)})())?((X=T.getElementById(e.skrollrBody||f))&&J(),$(),ye(p,[a,s],[i])):ye(p,[a,l],[i]),K.refresh(),fe(c,"resize orientationchange",function(){var e=p.clientWidth,t=p.clientHeight;t===Ce&&e===He||(Ce=t,He=e,Pe=!0)});var r=L();return function e(){_(),ce=r(e)}(),K}function M(e){var r=L();0==N&&(N=!0,function e(){var t=K.getScrollTop();_(),Ae!=t?ce=r(e):N=!1}())}var N=!1;B.prototype.refresh=function(e){var t,r,n=!1;for(e===S?(n=!0,Q=[],Ie=0,e=T.getElementsByTagName("*")):e.length===S&&(e=[e]),t=0,r=e.length;t<r;t++){var o=e[t],a=o,i=[],l=ne,s=le,c=!1;if(n&&C in o&&delete o[C],o.attributes){for(var f,u,m,p=0,g=o.attributes.length;p<g;p++){var d,v,h,y=o.attributes[p];if("data-anchor-target"!==y.name)"data-smooth-scrolling"!==y.name?"data-edge-strategy"!==y.name?"data-emit-events"!==y.name?null!==(h=y.name.match(P))&&(d={props:y.value,element:o,eventType:y.name.replace(I,k)},i.push(d),(v=h[1])&&(d.constant=v.substr(1)),v=h[2],/p$/.test(v)?(d.isPercentage=!0,d.offset=(0|v.slice(0,-1))/100):d.offset=0|v,v=h[3],h=h[4]||v,v&&"start"!==v&&"end"!==v?(d.mode="relative",d.anchors=[v,h]):(d.mode="absolute","end"===v?d.isEnd=!0:d.isPercentage||(d.offset=d.offset*we))):c=!0:s=y.value:l="off"!==y.value;else if(null===(a=T.querySelector(y.value)))throw'Unable to find anchor target "'+y.value+'"'}i.length&&(m=!n&&C in o?(u=o[C],f=Q[u].styleAttr,Q[u].classAttr):(u=o[C]=Ie++,f=o.style.cssText,he(o)),Q[u]={element:o,styleAttr:f,classAttr:m,anchorTarget:a,keyFrames:i,smoothScrolling:l,edgeStrategy:s,emitEvents:c,lastFrameIndex:-1},ye(o,[E],[]))}}for(ge(),t=0,r=e.length;t<r;t++){var b=Q[e[t][C]];b!==S&&(G(b),U(b))}return K},B.prototype.relativeToAbsolute=function(e,t,r){var n=p.clientHeight,o=e.getBoundingClientRect(),e=o.top,o=o.bottom-o.top;return t===d?e-=n:t===m&&(e-=n/2),r===d?e+=o:r===m&&(e+=o/2),(e+=K.getScrollTop())+.5|0},B.prototype.animateTo=function(e,t){},B.prototype.stopAnimateTo=function(){},B.prototype.isAnimatingTo=function(){},B.prototype.isMobile=function(){return Oe},B.prototype.setScrollTop=function(e,t){return ie=!0===t,Oe?Ve=g.min(g.max(e,0),xe):c.scrollTo(0,e),K},B.prototype.getScrollTop=function(){return Oe?Ve:c.pageYOffset||p.scrollTop||n.scrollTop||0},B.prototype.getMaxScrollTop=function(){return xe},B.prototype.on=function(e,t){return ee[e]=t,K},B.prototype.off=function(e){return delete ee[e],K},B.prototype.destroy=function(){var e;(e=c.cancelAnimationFrame||c[V.toLowerCase()+"CancelAnimationFrame"],e=Oe||!e?function(e){return c.clearTimeout(e)}:e)(ce),c.removeEventListener("scroll",M),N=!1,me(),ye(p,[i],[a,l,s]);for(var t=0,r=Q.length;t<r;t++)Z(Q[t].element);p.style.overflow=n.style.overflow="",p.style.height=n.style.height="",X&&x.setStyle(X,"transform","none"),Ee="down",Oe=Pe=!(Ae=-(we=1)),Ve=Ie=Ce=He=xe=0,se=le=ie=ae=oe=ne=re=te=ee=X=K=S};var $=function(){},_=function(){Pe&&(Pe=!1,ge());var e,t,r=K.getScrollTop(),n=Se();ie||(e=ae.targetTop-r,n<=(ae=e?{startTop:Ae,topDiff:r-Ae,targetTop:r,startTime:Fe,endTime:Fe+oe}:ae).endTime&&(t=q.sqrt((n-ae.startTime)/oe),r=ae.startTop+t*ae.topDiff|0)),!ie&&Ae===r||(t={curTop:r,lastTop:Ae,maxTop:xe,direction:Ee=Ae<r?"down":r<Ae?"up":Ee},(ie=!1)!==(ee.beforerender&&ee.beforerender.call(K,t))&&(function(e,t){for(var r=0,n=Q.length;r<n;r++){var o,a=Q[r],i=a.element,l=a.smoothScrolling?e:t,s=a.keyFrames,c=s.length,f=s[0],u=s[s.length-1],m=l<f.frame,p=l>u.frame,g=m?f:u,d=a.emitEvents,v=a.lastFrameIndex;if(m||p){if(m&&-1===a.edge||p&&1===a.edge)continue;switch(m?(ye(i,[A],[H,F]),d&&-1<v&&(pe(i,f.eventType,Ee),a.lastFrameIndex=-1)):(ye(i,[H],[A,F]),d&&v<c&&(pe(i,u.eventType,Ee),a.lastFrameIndex=c)),a.edge=m?-1:1,a.edgeStrategy){case"reset":Z(i);continue;case"ease":l=g.frame;break;default:var h=g.props;for(o in h)w.call(h,o)&&(T=Y(h[o].value),0===o.indexOf("@")?i.setAttribute(o.substr(1),T):x.setStyle(i,o,T));continue}}else 0!==a.edge&&(ye(i,[E,F],[A,H]),a.edge=0);for(var y=0;y<c-1;y++)if(l>=s[y].frame&&l<=s[y+1].frame){var b,T,S=s[y],k=s[y+1];for(o in S.props)w.call(S.props,o)&&(b=(l-S.frame)/(k.frame-S.frame),b=S.props[o].easing(b),T=W(S.props[o].value,k.props[o].value,b),T=Y(T),0===o.indexOf("@")?i.setAttribute(o.substr(1),T):x.setStyle(i,o,T));d&&v!==y&&(pe(i,("down"===Ee?S:k).eventType,Ee),a.lastFrameIndex=y);break}}}(r,K.getScrollTop()),Oe&&X&&x.setStyle(X,"transform","translate(0, "+-Ve+"px) "+se),Ae=r,ee.render&&ee.render.call(K,t))),Fe=n},G=function(e){for(var t=0,r=e.keyFrames.length;t<r;t++){for(var n,o,a,i=e.keyFrames[t],l={};null!==(a=v.exec(i.props));)o=a[1],n=a[2],a=null!==(a=o.match(h))?(o=a[1],a[2]):"linear",n=n.indexOf("!")?R(n):[n.slice(1)],l[o]={value:n,easing:q[a]};i.props=l}},R=function(e){var t=[];return b.lastIndex=0,e=e.replace(b,function(e){return e.replace(r,function(e){return e/255*100+"%"})}),z&&(O.lastIndex=0,e=e.replace(O,function(e){return z+e})),e=e.replace(r,function(e){return t.push(+e),"{?}"}),t.unshift(e),t},U=function(e){for(var t={},r=0,n=e.keyFrames.length;r<n;r++)j(e.keyFrames[r],t);for(t={},r=e.keyFrames.length-1;0<=r;r--)j(e.keyFrames[r],t)},j=function(e,t){for(var r in t)w.call(e.props,r)||(e.props[r]=t[r]);for(r in e.props)t[r]=e.props[r]},W=function(e,t,r){var n=e.length;if(n!==t.length)throw"Can't interpolate between \""+e[0]+'" and "'+t[0]+'"';for(var o=[e[0]],a=1;a<n;a++)o[a]=e[a]+(t[a]-e[a])*r;return o},Y=function(e){var t=1;return y.lastIndex=0,e[0].replace(y,function(){return e[t++]})},Z=function(e,t){for(var r,n,o=0,a=(e=[].concat(e)).length;o<a;o++)n=e[o],(r=Q[n[C]])&&(t?(n.style.cssText=r.dirtyStyleAttr,ye(n,r.dirtyClassAttr)):(r.dirtyStyleAttr=n.style.cssText,r.dirtyClassAttr=he(n),n.style.cssText=r.styleAttr,ye(n,r.classAttr)))},J=function(){se="translateZ(0)",x.setStyle(X,"transform",se);var e=o(X),t=e.getPropertyValue("transform"),e=e.getPropertyValue(z+"transform");t&&"none"!==t||e&&"none"!==e||(se="")};x.setStyle=function(e,t,r){e=e.style;if("zIndex"===(t=t.replace(I,k).replace("-","")))isNaN(r)?e[t]=r:e[t]=""+(0|r);else if("float"===t)e.styleFloat=e.cssFloat=r;else try{V&&(e[V+t.slice(0,1).toUpperCase()+t.slice(1)]=r),e[t]=r}catch(e){}};var K,Q,X,ee,te,re,ne,oe,ae,ie,le,se,ce,fe=x.addEvent=function(e,t,r){for(var n,o=function(e){return(e=e||c.event).target||(e.target=e.srcElement),e.preventDefault||(e.preventDefault=function(){e.returnValue=!1,e.defaultPrevented=!0}),r.call(this,e)},a=0,i=(t=t.split(" ")).length;a<i;a++)n=t[a],e.addEventListener?e.addEventListener(n,r,!1):e.attachEvent("on"+n,o),ze.push({element:e,name:n,listener:r})},ue=x.removeEvent=function(e,t,r){for(var n=0,o=(t=t.split(" ")).length;n<o;n++)e.removeEventListener?e.removeEventListener(t[n],r,!1):e.detachEvent("on"+t[n],r)},me=function(){for(var e,t=0,r=ze.length;t<r;t++)e=ze[t],ue(e.element,e.name,e.listener);ze=[]},pe=function(e,t,r){ee.keyframe&&ee.keyframe.call(K,e,t,r)},ge=function(){var e=K.getScrollTop();xe=0,te&&!Oe&&(n.style.height=""),function(){for(var e,t,r,n,o,a,i,l,s,c=p.clientHeight,f=de(),u=0,m=Q.length;u<m;u++)for(t=(e=Q[u]).element,r=e.anchorTarget,o=0,a=(n=e.keyFrames).length;o<a;o++)l=(i=n[o]).offset,s=f[i.constant]||0,i.frame=l,i.isPercentage&&(i.frame=l*=c),"relative"===i.mode&&(Z(t),i.frame=K.relativeToAbsolute(r,i.anchors[0],i.anchors[1])-l,Z(t,!0)),i.frame+=s,te&&!i.isEnd&&i.frame>xe&&(xe=i.frame);for(xe=g.max(xe,ve()),u=0,m=Q.length;u<m;u++){for(o=0,a=(n=(e=Q[u]).keyFrames).length;o<a;o++)s=f[(i=n[o]).constant]||0,i.isEnd&&(i.frame=xe-i.offset+s);e.keyFrames.sort(ke)}}(),te&&!Oe&&(n.style.height=xe+p.clientHeight+"px"),Oe?K.setScrollTop(g.min(K.getScrollTop(),xe)):"ontouchstart"in c||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints||K.setScrollTop(e,!0),ie=!0},de=function(){var e,t,r=p.clientHeight,n={};for(e in re)"function"==typeof(t=re[e])?t=t.call(K):/p$/.test(t)&&(t=t.slice(0,-1)/100*r),n[e]=t;return n},ve=function(){var e=0;return X&&(e=g.max(X.offsetHeight,X.scrollHeight)),g.max(e,n.scrollHeight,n.offsetHeight,p.scrollHeight,p.offsetHeight,p.clientHeight)-p.clientHeight},he=function(e){var t="className";return c.SVGElement&&e instanceof c.SVGElement&&(e=e[t],t="baseVal"),e[t]},ye=function(e,t,r){var n="className";if(c.SVGElement&&e instanceof c.SVGElement&&(e=e[n],n="baseVal"),r!==S){for(var o=e[n],a=0,i=r.length;a<i;a++)o=Te(o).replace(Te(r[a])," ");for(var o=be(o),l=0,s=t.length;l<s;l++)-1===Te(o).indexOf(Te(t[l]))&&(o+=" "+t[l]);e[n]=be(o)}else e[n]=t},be=function(e){return e.replace(t,"")},Te=function(e){return" "+e+" "},Se=Date.now||function(){return+new Date},ke=function(e,t){return e.frame-t.frame},xe=0,we=1,Ee="down",Ae=-1,Fe=Se(),He=0,Ce=0,Pe=!1,Ie=0,Oe=!1,Ve=0,ze=[];"function"==typeof define&&define.amd?define([],function(){return x}):"undefined"!=typeof module&&module.exports?module.exports=x:c.skrollr=x}(window,document);

  
///////////////////////////  
//    Content            //
/////////////////////////// 
 
var base = window.base || {}; 
var webroot = '/';


var htmltag = document.documentElement;

/** Dimension helpers */
base.getPageY = function() { return window.pageYOffset || ((('clientHeight' in htmltag))?htmltag:document.body).scrollTop; };
base.getWinW = function() { return window.innerWidth||htmltag.clientWidth||document.body.clientWidth||$(window).width(); };
base.getWinH = function() { var h = window.innerHeight||htmltag.clientHeight||document.body.clientHeight||$(window).height(); return h; };


/** Touch device
 */
base.isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);
if(base.isTouch) {
	htmltag.className = htmltag.className + ' touch';
} else {
	htmltag.className = htmltag.className + ' no-touch';
}


/**
  [ Detect iOS Version ]
  supports iOS 2.0 or latter
  call iOSversion() function will get:
    status: boolean;  -- get iOS version: true, none: false
    version: int; -- ex 11
    info: string; -- ex IOS 11.2.6 
*/
// base.ios = (function() {
// 	var d, v;
// 	if (/iP(hone|od|ad)/.test(navigator.platform)) {
// 		v = (navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);
// 		d = {
// 			status: true,
// 			version: parseInt(v[1], 10) , 
// 			info: parseInt(v[1], 10)+'.'+parseInt(v[2], 10)+'.'+parseInt(v[3] || 0, 10)
// 		};
// 	} else {
// 		d = {status:false, version: false, info:''}
// 	}
// 	return d;
// })();

/**
 * https://stackoverflow.com/questions/7184573/pick-up-the-android-version-in-the-browser-by-javascript
 * getAndroidVersion(); //"4.2.1"
 * parseInt(getAndroidVersion(), 10); //4
 * parseFloat(getAndroidVersion()); //4.2
 */
// base.android = (function() {
//     ua = navigator.userAgent.toLowerCase(); 
//     var match = ua.match(/android\s([0-9\.]*)/i);
//     return parseFloat(match ? match[1] : undefined);
// })();


/**
 * Specificly exclude certance browser version
 * to fine-tune good animation & user experience
 */
// Exclude touch device, IE, smaller screen, tablet,
// old modern browser like Safari 10
// var isModernPC = !base.isTouch && base.getWinW() > 1024 && !window.document.documentMode && supportUnPrefixSticky(); 
// if(isModernPC) { htmltag.className = htmltag.className + ' mpc';} // `modern pc`


// Exclude old iPhone & Android
// var isOldMobile = (base.ios.status && base.ios.version <= 12) || !!(base.android && base.android < 7);
// if(isOldMobile) { htmltag.className = htmltag.className + ' omb'; } // `old mb`
// else 			{ htmltag.className = htmltag.className + ' mmb'; } // `modern mb`



// Legacy IE
//base.IE = (document.documentMode <= 11);


/** Avoid touchmove event propagating from scrollable child (overflow:scroll) to window.
 * Support touch device only
 * and can't be tested on Chrome developer simulator.
 * 
 * @see https://github.com/lazd/iNoBounce
 * @version 20191220 
 */
$.fn.blockTouchmove = function(exclude) {
	return this.each(function(){
		$(this)
			.off('touchstart.btm touchmove.btm')
			.on('touchstart.btm', function(e) {
				this.btm_y = e.originalEvent.touches ? e.originalEvent.touches[0].screenY : e.originalEvent.screenY;
			})
			.on('touchmove.btm', function(e) {
				if(exclude!=undefined && $(exclude).find(e.target)[0]) {
					return true;
				}
				if(this.scrollHeight > this.offsetHeight) {
					var y = e.originalEvent.touches ? e.originalEvent.touches[0].screenY : e.originalEvent.screenY;
					var atTop = (this.btm_y <= y && this.scrollTop <= 0);
					var atBottom = (this.btm_y >= y && this.scrollHeight - this.scrollTop <= /*this.offsetHeight*/$(this).innerHeight());
	
					if(atTop || atBottom) {
						!!e.cancelable && e.preventDefault();
					}
				}
				else {
					!!e.cancelable && e.preventDefault();
				}
			});
	});
};


/** 頁面scroll狀態
 * @version 20220101 scrolled-up/scrolled-down version
 *************************/

// Flag to tell if the scrolling change was programmatic or by the user
//base.ignoreScrolled = true; //20220707 removed
if(base.getPageY() >= 100) { //@@20220707 added
	document.documentElement.className += ' header--fixed scrolled-down';
}

$(function() {
	
	//$(window).on('scroll resize orientationchange load touchmove', $.debounce(5, true, update));
	$(window).on('scroll resize orientationchange load touchmove', update);
	setTimeout(update, 31);
	setTimeout(update, 300);
	
	var html = $('html'),
		isFixed = html.hasClass('header--fixed'),
		lastScrollY = 0,
		scrollThreshold;
		
	
	setTimeout(function(){
		//base.ignoreScrolled = false; //20220707 removed
		//html.addClass('scrolled-down'); //20220707 removed
		html.addClass('header--anim'); //@@20220707 added
	}, 300);

	
	function update() {
		var scrollY = base.getPageY(),
			vh = base.getWinH(),
			top = 100,
			bottom = html.outerHeight() - vh - 60,
			state;
		
		// Header 置頂狀態 
		//if(!isFixed) {
			state = 'header--fixed';
			
			if(scrollY >= top && !html.hasClass(state)) {
				html.addClass(state);
			}
			else if(scrollY < top && html.hasClass(state)) {
				html.removeClass(state);
			}
		//}
		
		// 頁面已scroll離開置頂
		state = 'leave-top';
		if(scrollY >= vh*.4) {
			html.addClass(state, scrollY >= vh*.4 );
			scrollThreshold = 20;
		}
		else {
			html.removeClass(state, scrollY >= vh*.4 );
			scrollThreshold = 6;
		}
		
		
		
		// 往上捲動才出現header
		if(!base.ignoreScrolled) { 
			if(//scrollY > vh*.5 && //20220707 removed
			   (scrollY < lastScrollY - scrollThreshold || scrollY <= 0)) { // 往回(往上)捲
				html.addClass('scrolled-up').removeClass('scrolled-down');
			}
			else if(
				scrollY >= vh*.4 &&   //20220707 added
				scrollY > lastScrollY + scrollThreshold*.5){
				html.addClass('scrolled-down').removeClass('scrolled-up');
			}
			lastScrollY = scrollY;
		}
		
		
		// 頁面已scroll到底狀態 	
		state = 'reach-bottom';
		
		if(scrollY >= bottom && !html.hasClass(state)) {
			html.addClass(state);
			
		}
		else if(scrollY < bottom && html.hasClass(state)) {
			html.removeClass(state);
		}
	}
});



/**
 * Correct 100vh
 * @20220310
 * Do not constantly fire by using window resize event
 * which brings up Swiper buggy sliding (iOS address bar issue)
 */
var update100vh = (function(){
	function resize() {
		document.documentElement.style.setProperty('--vh', window.innerHeight + 'px');
		//console.log('resize', window.innerHeight); 
	}
	window.addEventListener('orientationchange', function(){
		//https://stackoverflow.com/questions/12452349/mobile-viewport-height-after-orientation-change
		var fn = function() {
			resize();
			window.removeEventListener('resize', fn);
		};
		window.addEventListener('resize', fn);
	});
	resize();
	return resize;
})();
 



/** Header & panel
 * 
 * [js-panel], [js-panel-btn]
 * base.openPanel
 * base.closePanel
 * 
 * @version 20220219 Add Keyboard support. Revise event delegation. Comment out level sliding related script.
 * @version 20220222 Revise fix to overflow chaining due to iOS 15+ furthur manipulation of Safari address bar
 * @version 20230407 Add `aria-label`, fix tab index.
 *************************/


/** PC navigation
 *************************/
$(function(){
	
	var	timer;
	
	// Mouse
	if(!base.isTouch) {
		
		// pc主選單 [js-panel-btn] 
		// 各自對應的 panel 子選單
		$(document).on('mouseenter mouseleave click focusin'/*keydown*/, '.navbar [js-panel-btn]', function(e){
			var el = this,
				btn = $(el),
				id = btn.attr('js-panel-btn'),
				panel = $('[js-panel="'+id+'"]');
			
			if(!panel[0]) { return true; }
				
			switch(e.type) {
				case 'mouseenter':
				case 'focusin':
					clearTimeout(timer);
					timer = setTimeout(function(){
						
						toggleBtn(btn, true);
						
						el.mouseDisabled = true;
						timer = setTimeout(function(){ el.mouseDisabled = false; }, 350);

					}, !base.activePanelId?150:1);
					break;
				
				// 避免一離開按鈕 panel就關閉
				case 'mouseleave':
					delayClosePanel();
					break;
				
				case 'click':
					if(el.mouseDisabled) { return true; } // Avoid immediate click and close an opened panel
					
					toggleBtn(btn);
					break;
				
				// case 'keydown':
				// 	if(e.keyCode == 40) {
				// 		toggleBtn(btn, true);
				// 		var child = panel.find('[tabindex], a, button, [role="button"]')[0];
				// 		!!child && child.focus();
				// 		e.preventDefault();
				// 	}
				// 	break;
			}
		});

	
		
		
		// 避免一離開按鈕 panel就關閉
		$(document).on('mouseenter', '[js-panel]', function(e){
			clearTimeout(timer);
		});
		
		// Mouse out 子選單
		$(document).on('mouseleave', '[js-panel^="subnav-"]', function(e){
			delayClosePanel();
		});
		
		$('<span tabindex="0"></span>').on('focusin', function(e){
			delayClosePanel();
		}).appendTo('[js-panel^="subnav-"]');


		// Mouse over 沒有子選單的主項關閉 active panel
		/*$('.navbar-link').not('[js-panel-btn]').on('mouseenter', function(e){
			delayClosePanel();
		});*/
		
		$(document).on('keydown', '.masthead', function(e){ 
			if(e.keyCode == 27) {
				base.closePanel();
			}
		});
	}
	
	// Touch
	else {
		$(document).on('click', '.navbar [js-panel-btn]', function(e){
			var btn = $(this); 
			switch(e.type) {
				case 'click':
					toggleBtn(btn);
					e.stopPropagation();
					e.preventDefault();
					break;
			}
		});
	}
	
	// 全站搜尋
	//$(document).on('click', '[js-panel-btn="searchbox"]', function(e){
	//	toggleBtn($(this));
	//});


	// Auto set focus on 搜尋 input
	//$(document).on('open', '[js-panel="searchbox"]', function(e){
	//	var input = $('[type="text"]', this).get(0);
	//	if(!!input){
	//		//input.focus(); // ios
	//		!base.isTouch && setTimeout(function(){ input.focus(); }, 200); // desktop
	//	}
	//});

	

	// 全站語言選擇
	$(document).on('click', '[js-panel-btn="langsel"]', function(e){
		toggleBtn($(this));
		$('[js-panel="langsel"]')[0].focus();
	});


	function delayClosePanel() {
		clearTimeout(timer);
		timer = setTimeout(function(){
			base.closePanel();
		}, 300);
	};
	
	function toggleBtn(btn, forceOpen) {
		var id = btn.attr('js-panel-btn');
						
		if(!btn.hasClass('opened') || forceOpen == true) { // revised @20210515
			btn.addClass('opened');
			btn.attr('aria-expanded', true);
			
			// Set subnav position
			var panel = $('[js-panel="'+id+'"]');
			//var left = btn.parent().position().left - (panel.outerWidth() - btn.outerWidth())*.5;
			var left = btn.parent().position().left;
			panel.css({ left: left });
			
			base.openPanel(id, btn);
			
			panel.one('close', function(e) {
				btn.removeClass('opened');
				btn.attr('aria-expanded', false);
			});
		}
		else {
			btn.removeClass('opened');
			btn.attr('aria-expanded', false);
			base.closePanel();
		}
	};
	
});


/** Mobile navigation
 *************************/
$(function(){
	var scrollY;
	
	// Hamburger button
	$(document).on('click', '.masthead-toggle', function(){
		if(!$('html').hasClass('mbpanel--open')) {
			base.openPanel('mbpanel');
		}
		else {
			base.closePanel();
		}
	});

	
	// Event callback
	$(document).on('open close', '[js-panel="mbpanel"]', function(e){
		
		if(e.type == 'open') {
			// Avoid touchmove body content, @20220222 mostly still works today 
			$('.mbpanel-col').blockTouchmove();
			
			// https://github.com/willmcpo/body-scroll-lock
			// Had tried but surpisely found no work anymore on iOS 15+ Safari!
			//bodyScrollLock.disableBodyScroll($('.mbpanel')[0]);
			//bodyScrollLock.enableBodyScroll($('.mbpanel')[0]);
			
			scrollY = window.scrollY;  
			//alert('window.scrollY='+window.scrollY); // IE does support `window.scrollY`
			
			
			// @20220222
			// Issue: https://stackoverflow.com/questions/69310544/ios-15-safari-toolbar-now-hides-when-scrolling-within-an-element
			// Prevent iOS 15+ Safari from hiding address bar when .mbpanel is visible
			// https://pqina.nl/blog/how-to-prevent-scrolling-the-page-on-ios-safari/
			
			// Lock window height and then store scroll position for later restore
			$('html').addClass('mbpanel--open');
			base.ignoreScrolled = true; //@@20220707 added

			if(scrollY != undefined) { 
				$('html')[0].scrollTo(0, scrollY);
				$('body')[0].scrollTo(0, scrollY);
				window.scrollTo(0, scrollY);
			}
		}
		
		// 'close'
		else {
			
			$('[js-panel="mbpanel"]').addClass('animate-out');
			setTimeout(function(){
				$('[js-panel="mbpanel"]').removeClass('animate-out');
			}, 250);
			
			
			$('html').removeClass('mbpanel--open');
			
			if(scrollY != undefined) {
				window.scrollTo(0, scrollY);
			}

			base.ignoreScrolled = false; //@@20220707 added
		}

		$('.masthead-toggle').attr('aria-expanded', e.type == 'open');
	});
	
	
});


/** Click anywhere to close panel
 *************************/ 
$(function(){
	document.documentElement.addEventListener(!base.isTouch?'click':'touchend', clickAnywhere, true); // Fire event on capturing phase
	
	function clickAnywhere(e) {
		if($('.panel--active').length == 0) {
			return true;
		}
		if(!$('.masthead').find(e.target)[0] || $(e.target).is('[js-panel="mbpanel"]')) {
			base.closePanel();
			e.stopPropagation();
			e.stopImmediatePropagation();
			return false;
		}
	}
});


/** Panel controller
 *************************/

base.activePanelId = undefined;

base.openPanel = function(id) {
	var panel = $('[js-panel="'+id+'"]');
	if(!panel[0]) { return false;}
	
	if(base.activePanelId == id) { 
		//base.closePanel();
		return;
	}
	
	base.closePanel();
	
	base.activePanelId = id;
	//console.log('%c openPanel id= ' + base.activePanelId, 'font-weight:700;color:#fff;background:#24BCDC'); 
	
	panel.addClass('panel--active');
	
	panel.trigger('open');
}
	
base.closePanel = function() {
	var panel = $('.panel--active[js-panel]');
	if(!panel[0]) { return false;}
	
	base.activePanelId = undefined;
	//console.log('%c closePanel '+ panel.attr('js-panel'), 'font-weight:700;color:#fff;background:#24BCDC'); 
	
	panel.removeClass('panel--active');
	
	panel.trigger('close');
}


/** Accessibility role 
 * @20230413 added
 */
 $(function(){
 	if(!$('.navbar').is(':visible')) {
 		$('.mbpanel').attr('role', 'navigation');
 		$('.navbar, .masthead-langsel').attr('aria-hidden', true);
 	}
 	else {
 		$('.navbar').attr('role', 'navigation');
 		$('.mbpanel, .masthead-toggle').attr('aria-hidden', true);
 	}
 });


/** Foldable
 * @version 20220626 revised & added location hash support
 * @version 20230407 added `aria-*` & bug fix
 *************************/
$(function(){
	var state = 'foldable--expanded',
		re = /^\/fold\-\d{1,2}$/i;
	
	$(document).on('click.foldable keydown.foldable', '[js-foldable-head]', function(e){
		if(e.type == 'click' || (e.type == 'keydown' && e.keyCode == 13)) {
			e.preventDefault();
			toggle(this);
		}
	});

	function toggle(el, bool) {
		var head = $(el),
			holder = $(el).closest('[js-foldable-group]'),
			holderId = holder[0].id,
			id = holder.attr('js-foldable-group'),
			body = holder.find('[js-foldable-body]').first();
		
		// open
		if(bool || !holder.hasClass(state)) { 
			body.slideDown(300, function(){
				head.trigger('foldAfterOpen', [head, body, id]);
			});
			holder.addClass(state);
			head.trigger('foldBeforeOpen', [head, body, id]);
			head.attr('aria-expanded', true).attr('aria-selected', true); //20230407
			body.attr('aria-hidden', false); //20230407

			// Bind identical ID to the group of `js-foldable-group` foldable items
			// to behave like accordian UI
			if(!!id) {
				//$('[js-foldable-group="'+ id +'"]').not(holder).each(function(){
				//	$(this)
				//		.removeClass(state)
				//		.find('[js-foldable-body]').first().slideUp(300);
				//});
				$('.'+state+'[js-foldable-group="'+ id +'"]').not(holder).each(function(){
					toggle($(this).find('[js-foldable-head]'), false);
				});
			}


			// Update hash
			if(bool == undefined && !!holderId && re.test('/' + holderId)) {
				// Create history entry on each click
				//location.hash = '/' + holder[0].id; 
				
				// Update hash without afftect history entry
				history.replaceState({},'','#/' + holderId); 
			}
		}
		
		// close
		else { 
			body.slideUp(300, function(){
				head.trigger('foldAfterClose', [head, body, id]);
			});
			holder.removeClass(state);
			head.trigger('foldBeforeClose', [head, body, id]);
			head.attr('aria-expanded', false).attr('aria-selected', false); //20230407
			body.attr('aria-hidden', true); //20230407
		}
	}

	
	// Initially expanded `foldable--expanded` foldable item
	$('.'+state+' [js-foldable-head]').each(function(){
		//console.log(this);
		toggle(this, true)
		//$(this).find('[js-foldable-head]').trigger('click.foldable');
	});


	// Expand and scroll to item by URL hash
	if(re.test(location.hash.substr(1))) {
		var holderId = '#' + location.hash.substr(2),
			head = $(holderId + ' [js-foldable-head]');
		
		if(head[0]) {
			//el.find('[js-foldable-head]').trigger('click.foldable');
			toggle(head, true);
			
			// Scroll into view
			var scrollY = head.offset().top - 70;
			setTimeout(function(){
				window.scrollTo(0, scrollY); 
			}, 500);
			setTimeout(function(){
				window.scrollTo(0, scrollY); 
			}, 1000);
		}
	}
});



/** 橫向選單捲軸提示
 * @version 20240316
 * 
 * 支援兩種設定做法
 * 
 * (1) Browser native overflow scrollbar -
 *
 * 	   <div js-scrollhint="holder">
 *        <div js-scrollhint="scroller">
 *         	 <div>item</div>
 *         	 <div class="active">item</div>  <!-- active item -->
 *         	 <div>item</div>
 *        </div>
 *     </div>
 *     
 * (2) 搭配 Swiper.js "freemode" -
 *
 * 	   HTML列表結構需綁定 Swiper 必要 class (.swiper-containter, .swiper-wrapper, .swiper-slide)，
 * 	   參見 js/partials/_scrollhint.js 說明
 *
 *     <div class="swiper-container" js-scrollhint="holder" js-swiper-option='{"xs":"auto", "autoHeight":false, "freeMode":true}'>
 *     	 <div class="swiper-wrapper" js-scrollhint="scroller">
 *     		<div class="swiper-slide">item</div>
 *     		<div class="swiper-slide active">item</div> <!-- active item -->
 *     		<div class="swiper-slide">item</div>
 *     		...
 *     	 </div>
 *     </div>
 *************************/
$(function(){
	//@20240316
	var attr_holder = '[js-scrollhint="holder"]', 
		attr_scroller = '[js-scrollhint="scroller"]';

	if(!$(attr_holder)[0]) { return; }
	
	$(attr_holder).each(function(){
		var holder = $(this),
			scroller = $(attr_scroller, holder);
		
		if(!!$('.scrollhint', holder)[0]) { return true; }
		
		$('<div class="scrollhint"><i class="ico ico-ui-right-v"></i></div>').appendTo(holder);
		$('.scrollhint', holder).on('click', function(e){
			var swiper = holder.get(0).swiper;
			if(!!swiper) {
				swiper.slideNext();
			}
			else {
				scroller.animate({scrollLeft: scroller.scrollLeft() + 100}, 168);
			}
		});
		
		/*if(!/abs|rel/.test(holder.css('position'))) {
			holder.css('position', 'relative');
		}*/
	});
	
	render();
	setTimeout(render, 31);
	setTimeout(render, 500);
	$(window).on('resize', $.debounce(500,render));
	
	$(attr_scroller).on('scroll', $.debounce(100, function(){
		updateScrollHint($(this).parents(attr_holder));
	}));

	function render() {
		$(attr_holder).each(function(){
			var holder = $(this),
				scroller = $(attr_scroller, holder);
				//state = 'scrollhint--show';
			
			//@20240316
			updateScrollHint(holder);
			
			
			// 捲到 active item 定位
			var activeBtn = $('.active, .on', scroller); //@20240316
			
			if(activeBtn[0]) {
				var swiper = holder.get(0).swiper;
				// Swiper
				if(!!swiper) {
					swiper.slideTo(activeBtn.index(), 300); //@20240316
				}
				// Native overflow-x:auto
				else {
					var x = -20 + Math.max(0, activeBtn.get(0).offsetLeft/* - activeBtn.outerWidth()*/);
					//scroller.scrollLeft(x);
					scroller.animate({scrollLeft: x}, 168); //@20240316
				}
			}
		});
	}

	//@20240316
	function updateScrollHint(holder) {
		var s = $(attr_scroller, holder),
			state = 'scrollhint--show',
			sw = s[0].scrollWidth,
			hw = holder.outerWidth()/* + 10*/,
			sm = sw - s[0].clientWidth - 10; //scroll left max

		if(sw > hw && (s[0].scrollLeft < sm)/*not reach end*/ && !holder.hasClass(state) ) {
			holder.addClass(state);
		}
		else if((sw <= hw || (s[0].scrollLeft >= sm)/*reach end*/) && holder.hasClass(state)) {
			holder.removeClass(state);
		}
	}

	

});
/** Section intersection control by using Lazyload
 * to trigger section animation
 * @20240625 
 */
;(function(){

	// required intersection-observer.min.js to support `rootMargin` property of IntersectionObserver
	//var rootMargin = '0% 0px -18% 0px';   
	var rootMargin = '7% 0px 5% 0px';

	// Custom css transition bind with .anim-wrap
	var els = '.anim-wrap';
	Array.prototype.forEach.call(document.querySelectorAll(els), function(el, i){
		el.classList.add('ll');
	});
	
	new LazyLoad({
		elements_selector: els,
		thresholds: rootMargin,
		class_entered: 'llin',
		class_exited: 'llout',

		// Use case:
		// 	$('.anim-wrap').on('llIn llOut', function(e){
		// 		console.log(this.id, e.type);
		// 	});

		callback_enter: function(el) {
			$(function(){
				var wrap = $(el);
				if(!wrap[0].visited) {
					wrap.trigger('llIn', [false]);
					wrap[0].visited = true;	
				}
				else {
					wrap.trigger('llIn', [true]);
				}
			});
		},
		callback_exit: function(el) {
			$(function(){
				var wrap = $(el);
				wrap.trigger('llOut');
			});
		}
	});
	
	
	// Preset css transition bind with .anim-XXX
	els = '.anim-fade, .anim-fadeout, .anim-up, .anim-down, .anim-left, .anim-right, .anim-scalein';
	Array.prototype.forEach.call(document.querySelectorAll(els), function(el, i){
		el.classList.add('ll');
	});
	
	new LazyLoad({
		elements_selector: els,
		thresholds: rootMargin,
		class_entered: 'llin',
		class_exited: 'llout'
	});
})();





/** Skrollr parallax animation
 *  Animate with user scrolling page
 * 
 * - @20240619 Dont use percentage (%) unit to set CSS value 
 *   to avoid a result of un-smoothing jaggy bumpy transition 
 *************************/
;(function(){

	var lastScrollY = base.getPageY(),	
		smoothScrollingDurationIntvId;


    // Initialization
    var options = { 
        forceHeight: false,
        smoothScrolling: !base.isTouch,
        smoothScrollingDuration: 350, 
        //edgeStrategy: 'ease',
        mobileCheck: function(){},
        easing: { // https://easings.net/zh-tw
            ease: function (x) {   //easeInOutSine
                return -(Math.cos(Math.PI * x) - 1) / 2; 
            }
        },
        //render: function(data){ 
            //console.log(data); //{curTop: 249, lastTop: 248, maxTop: 328, direction: 'down'}
        //},
        beforerender: $.throttle(100, checkHeavyScroll)
    }

    skrollr.init(options);


    function refreshSkrollr() {
        skrollr.get().refresh();  
    }


    // @20240625 
    // Refine transtion case like user instant scroll, like using keyboard (up/down/home/space) or mouse click scrollbar track
    // by setting `smoothScrollingDuration` to zero
    function checkHeavyScroll(data) {
    	if(base.isTouch) { return true; }

    	var pageY = base.getPageY();
    	if(Math.abs(pageY - lastScrollY) > 800) {
    		//console.log('heavy scroll!', data);
    		setSmoothScrollingDuration(0);
    		
    		clearTimeout(smoothScrollingDurationIntvId);
    		smoothScrollingDurationIntvId = setTimeout(function(){
    			setSmoothScrollingDuration(options.smoothScrollingDuration);
    		}, 1000);
    	}
    	lastScrollY = pageY;
    }
    
    function setSmoothScrollingDuration(value) {
    	//console.log('smoothScrollingDuration=', value);
    	skrollr.get().destroy();
	    skrollr.init($.extend({}, options, { smoothScrollingDuration: value }));
    }


    $(function(){
    	//
    	// .topkv
    	//
    	(function(){
    		var el = $('.topkv-pic');
    		if(!el[0]) { return; }
    		el
    		 	.attr('data-0p',  	 'transform[ease]:translate3d(0,0px,0)')
    		 	.attr('data-100p', 	 'transform[ease]:translate3d(0,-200px,0)');
    	})();

    	//
    	// apply simple parallax
    	//
    	(function() {
    		var el = $('[skrollr-prlx]');
    		if(!el[0]) { return; }

    		el.each(function(){
    			var value = $(this).attr('skrollr-prlx').split(',');
	    		if(value.length == 2) {
	    			$(this)
		    		 	.attr('data-bottom-top', 'transform: translate3d(0,'+value[0]+',0)')
		    		 	.attr('data-top-bottom', 'transform: translate3d(0,'+value[1]+',0)');
	    		}
    		});
    		
    	})();	


    	//
    	// .h-110prlx image mask parallax 
    	//
    	(function(){
    		var el = $('.ofi-cover.h-110prlx');
    		if(!el[0]) { return; }
    		el
    		 	.attr('data--15p-bottom-top', 	 'transform: translate3d(0,-10%,0)')
    		 	.attr('data-20p-top-top', 'transform: translate3d(0,0%,0)');
    	})();


        // Recalculate skrollr
        refreshSkrollr();
        setTimeout(refreshSkrollr, 100);
    });
})();
/** Site images
 * Lazyload all <img> set `class="lazy"` and `data-src`
 */
var llSite = new LazyLoad({
    threshold: base.isTouch?500:300,
    //threshold: 400,
	callback_error: function(el) {
		//console.log('lazyload error',el);
	},
	callback_loaded: function(el) {
		//console.log('\t' + el.src || el.srcset); 
		
		//!!window.picturefill && picturefill({ reevaluate: true });

		// if(window.Swiper) {
		// 	var swiperEl = $(el).parents('.swiper-container')[0];
		// 	if(!!swiperEl) {
		// 		//console.log('swiperEl', swiperEl);
		// 		!!swiperEl.swiper && swiperEl.swiper.update();
		// 	}
		// }
	}
});


/** Backtop
 */
 $(function(){
 	$('[href="#backtop"]').on('click', function(e){
		//window.scrollTo({ left: 0, top: 0, behavior: 'smooth' });
		$("html, body").animate({ scrollTop: 0 });
		e.preventDefault();
 	});
 });



/** Video related
 */
$(function(){
	var logStyle 		= 'background:#444;color:#fff;padding:1px 4px';
	var logStyleReset 	= 'background:none;color:#000';

	/** Pause all the background video out of viewport
	 * by using Lazyload
	 */
	if(!!$('.bgvideo-holder video[autoplay]')[0]) { 
		new LazyLoad({
			elements_selector: '.bgvideo-holder',
			callback_enter: function(el) {
				var video = $('video', el)[0];
				playVideoEl(video, true);
			},
			callback_exit: function(el) {
				var video = $('video', el)[0];
				playVideoEl(video, false);
			}
		});
	}


	/** Pause all the background videos
	 *  as lity lightbox opened
     */
	$(document).on('lity:open lity:close', function(e, instance) {
        $('.bgvideo-holder video[autoplay]').each(function(){
        	if(e.type == 'lity:open') {
        		$(this).addClass('pausebylity');
        		playVideoEl(this, false);
        	}
        	else {
        		if($(this).hasClass('pausebylity')) {
        			playVideoEl(this, true);
        			$(this).removeClass('pausebylity');
        		}
        	}
        });
    });


	/** inline lity video popup
     */
    $(document).on('lity:ready lity:close lity:remove', function(e, instance) {
		var el = e.target;
		if(el.tagName.toLowerCase() == 'video') { 
			//console.log(e.type, $('.lity-wrap .vidpopup'));
			playVideoEl(el, e.type == 'lity:ready');
		}
	});

	function playVideoEl(el, state) {
		// `0` - `HAVE_NOTHING`：沒有資料可用。
		// `1` - `HAVE_METADATA`：已取得影片（音訊/視訊）的長寬等資訊，但還沒有足夠的資源下載以播放。
		// `2` - `HAVE_CURRENT_DATA`：已經快取足夠的資料，以讓目前播放點播放一個更長的影片元件。
		// `3` - `HAVE_FUTURE_DATA`：已經快取足夠的資料，以讓目前及下一個影片元件播放。
		// `4` - `HAVE_ENOUGH_DATA`：已經快取足夠的資源，可以開始播放。
		var readyState = el.readyState;

		if(readyState >= 2) {
			try { 
				if(state==true) { 
					el.play();
				}
				else {
					el.pause();
				}
			} catch(err) {}
		}
		
		if(readyState < 2 && state == true ) {
			//console.log('%c' + getSrc(el) +'%c bind canplay event', logStyle, logStyleReset);
			
			$(el).off('canplay').one('canplay', function(e){
		        this.play();
		        //console.log('%c'+getSrc(this)+ '%c canplay', logStyle, logStyleReset);
		    });
		}

		//console.log('playVideo ' + state + ' %c' + getSrc(el) + '%c' + ' readyState='+readyState, logStyle, logStyleReset);
	}

	function getSrc(el) {
		var src = el.querySelector('source').getAttribute('data-src') ||
					el.querySelector('source').getAttribute('src');
		src = src.split('img/')[1];
		return src;
	}
});




/** Top-right the close button of .popup 
 * of Lity lightbox
 */
$(function(){
	$(document).on('lity:ready', function(e, instance) {
		var page = $('.lity-wrap .popup');
		if(!page[0]){ return; }
		$('.lity-close').appendTo(page);
	});

	$(document).on('lity:close', function(e, instance) {
		var page = $('.lity-wrap .popup');
		if(!page[0]){ return; }
		$('.lity-close').remove();
	});
});



/** Google Map API
 */
$(function(){
	var el = $('#gmap');
	if(!el[0]) { return; }


	var position = {
			lat: parseFloat(el.attr('gmap-lat')),
			lng: parseFloat(el.attr('gmap-lng'))
		},
		place = el.attr('gmap-place'),
		url = 'https://www.google.com.tw/maps/place/' + place + '/@' + position.lat +','+position.lng,
		title = el.attr('gmap-marker'),
		apikey = el.attr('gmap-apikey');

	$('.btn-gmaplink').attr('href', url);
	console.log(title, url, place);

	let map, 
	    mapStyles = [ 
		    { "elementType": "geometry", "stylers": [{"color": "#f5f5f5"}]}, 
		    { "elementType": "labels.icon", "stylers": [{"visibility": "off"}]}, 
		    { "elementType": "labels.text.fill", "stylers": [{"color": "#616161"}]}, 
		    { "elementType": "labels.text.stroke", "stylers": [{"color": "#f5f5f5"}]}, 
		    { "featureType": "landscape", "elementType": "geometry.fill", "stylers": [{"color": "#f1efea"}]}, 

		    { "featureType": "poi", "stylers": [{"saturation": -100}, {"lightness": 35}, {"visibility": "off"}]}, 
		    { "featureType": "poi", "elementType": "geometry", "stylers": [{"color": "#ede8e2"}]}, 
		    { "featureType": "poi", "elementType": "labels.text.fill", "stylers": [{"lightness": -55}]}, 
		    { "featureType": "poi.business", "stylers": [{"saturation": -100}]}, 
		    { "featureType": "poi.medical", "stylers": [{"visibility": "on"}]}, 
		    { "featureType": "poi.park", "stylers": [{"visibility": "on"}]}, 
		    { "featureType": "poi.school", "stylers": [{"visibility": "on"}]}, 
		    { "featureType": "poi.sports_complex", "stylers": [{"visibility": "on"}]}, 

		    { "featureType": "road", "stylers": [{"saturation": -100}, {"visibility": "on"}]}, 
		    { "featureType": "road.arterial", "elementType": "geometry.fill", "stylers": [{"color": "#cfcfcf"}]}, 
		    { "featureType": "road.arterial", "elementType": "labels.text.fill", "stylers": [{"saturation": -100}, {"lightness": -55}]}, 
		    { "featureType": "road.highway", "elementType": "geometry", "stylers": [{"color": "#dadada"}]}, 
		    { "featureType": "road.highway", "elementType": "geometry.fill", "stylers": [{"lightness": -40}, {"weight": 6}]}, 
		    { "featureType": "road.highway", "elementType": "labels.icon", "stylers": [{"saturation": -100}]}, 
		    { "featureType": "road.highway", "elementType": "labels.text.fill", "stylers": [{"saturation": -100}, {"lightness": -55}]}, 
		    { "featureType": "road.local", "elementType": "geometry.fill", "stylers": [{"color": "#cfcfcf"}]}, 
		    { "featureType": "road.local", "elementType": "labels.text.fill", "stylers": [{"saturation": -100}, {"lightness": -55}]}, 

		    { "featureType": "transit", "stylers": [{"saturation": -100}]}, 
		    { "featureType": "water", "elementType": "geometry.fill", "stylers": [{"color": "#ffffff"}]}
		];

	function loadMapAPI(apikey) {
		;(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});
			var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));
				e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);
				a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";
				m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
			
			key: apikey,
			v: "weekly"
		});
	}
	async function initMap(position, title, place) {
		console.warn = function(){};
		
		const { Map } = await google.maps.importLibrary("maps");
		
		map = new Map(document.getElementById('gmap'), {
			center: position,
			zoom: 16, 
			minZoom: 9,
			streetViewControl: false,
			mapTypeControl: false,
			scaleControl: false,
			rotateControl: false,
			fullscreenControl: false,
			styles: mapStyles,
			language: 'zh-TW',
		});

		const infoContent = '<div class="h3 h4-mb fw-bolder text-serif text-lake">' + title 
							+ '</div><div class="h6 h7-mb fw-bold text-brown">' + place+ '</div>';
	    const infoWindow = new google.maps.InfoWindow({
	        content: infoContent,
	    });

		const marker = new google.maps.Marker({
		    position: position,
		    map,
		    icon: '/img/ui/gmap-marker.svg',
		    title: title
		});

	    marker.addListener("click", function(e){
	    	//infoWindow.setPosition({lat:position.lat - 0.1, lng:position.lng - 0.1});
	        infoWindow.open(map, marker);
	    });
	}

	
	el.on('llIn', function(e, visited){
		//console.log('visited', visited);
		if(!visited) {
			loadMapAPI(apikey);
			initMap(position, title, place);
		}
	});
});


/** News json
 */
$(function(){ 
	var list = $('.newslist[data-json]');
	if(!list[0]) { return; }

	var d = new Date(), 
		bust = ('?'+d.getDate()+''+d.getHours()+''+d.getMinutes()),
		url = list.attr('data-json');
	
	if(!url) { return; }
	
	url += bust;

	$.ajax(url, {
		dataType: 'json',
		error: function(){
			console.log('invalid JSON format'); 
			noData();
		},
		success: function(data, status, xhr){
			console.log('json success', data.length, url);
			if(!data || data.length == 0) { 
				noData();
				return;
			}
			render(data);
		}
	});

	function noData() {
		list.parents('section.news').hide();
	}

	function render(data) {
		var data = data.slice(0, 3); // Limit to 4 items
		//console.log('render', data.length);

		$.each(data, function(index, item){
			list.append(function(){
				var html = '<li>';

				if(!!item.date) {
					html += ('<time class="d-block">' + item.date + '</time>');
				}
				if(!item.link) {
					html += ('<p>' + item.title + '</p>');
				} else {
					html += ('<a class="text-gray" href="' + item.link  + '" target="_blank" rel="noopener noreferrer">' 
								+ item.title + '</a>');
				}
				html += '</li>';
				return html;
			});
		});
	}
});



